<!doctype html>
<html lang="hu">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0">
    <title>Anna √©s M√°rk</title>
    
    <meta http-equiv="Permissions-Policy" content="geolocation=*">
    <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* A CSS ST√çLUSOK IDE J√ñNNEK BE, V√ÅLTOZTAT√ÅS N√âLK√úL */
        /* Ezt a r√©szt a v√°lasz terjedelme miatt kihagytam, de a fent megadott k√≥db√≥l be kell illeszteni. */
        /* Ide illeszd be az eredeti k√≥dban l√©v≈ë teljes <style>...</style> blokkot. */
        
        /* --- K√âT FONTOS CSS M√ìDOS√çT√ÅS A DINAMIKUS H√ÅTT√âRHEZ √âS SZ√ñVEGSZ√çNHEZ --- */
        /* H√ÅTT√âR SZ√çN/K√âP ALAP√âRTELMEZ√âSE: A JS dinamikusan √°ll√≠tja be a CONFIG alapj√°n */
        body {
            /* ... az √∂sszes eredeti st√≠lus ... */
            background-color: #1a1a1a; /* Ezt most megtartjuk, a JS fel√ºl√≠rja, ha van CONFIG */
            color: #e0e0e0; /* Ezt is megtartjuk, a JS fel√ºl√≠rja */
        }
        
    </style>
</head>
<body oncontextmenu="return false;"> 
    <div class="full-width-image-container">
        <img id="story-image" src="" alt="Titokzatos jelenet" onerror="this.onerror=null; this.style.opacity='0';">
    </div>

    <div class="content-box" id="content-box">
        <img id="avatar-img" class="avatar-image" src="" alt="Szerepl≈ë avatar">
        
        <button id="discreet-back-button" class="discreet-back-button page-button" disabled style="display: none;">
            <i class="fa-solid fa-arrow-left"></i>
        </button>
        
        <p id="story-text-display"></p>
        
        <div id="audio-container-1" class="audio-container" style="display:none;">
             <button id="play-audio-button-1" class="audio-button">‚ñ∂Ô∏è Lej√°tsz√°s (1)</button>
        </div>
        <div id="audio-container-2" class="audio-container" style="display:none;">
             <button id="play-audio-button-2" class="audio-button">‚ñ∂Ô∏è Lej√°tsz√°s (2)</button>
        </div>


        <div class="bottom-bar">
            <div class="interaction-container" id="interaction-container">
                <button id="prev-page-button" class="page-button" disabled>
                    Vissza
                </button>
                
                <button id="next-page-button" class="page-button">
                    Tov√°bb
                </button>
            </div>
            
            <div class="multi-choice-container" id="multi-choice-container" style="display:none;">
                <button id="choice-1-button" class="page-button" data-next-index="2">
                    Megvizsg√°lod a f√ºlke belsej√©t
                </button>
                <button id="choice-2-button" class="page-button" data-next-index="0">
                    H√≠vod a kontaktot a rejtett frekvenci√°n
                </button>
                <button id="choice-3-button" class="page-button" data-next-index="">
                    Harmadik V√°laszt√°s
                </button>
                <button id="choice-4-button" class="page-button" data-next-index="" style="display: none;">
                    Negyedik V√°laszt√°s
                </button>
            </div>


            <div id="password-container">
                <p>
                    <span id="password-prompt-text">Add meg a k√≥dot:</span>
                    <button id="help-button" class="help-icon" title="Seg√≠ts√©g">
                        <i class="fa-solid fa-circle-question"></i>
                    </button>
                </p>
                <input type="text" id="password-input" maxlength="8">
                
                <div class="password-interaction">
                    <button id="back-button-password" class="page-button">
                        Vissza
                    </button>
                    <button id="check-password-button" class="page-button">
                        ELLEN≈êRZ√âS
                    </button>
                </div>
                <div id="room-link-container" style="display: none; margin-top: 10px; width: 100%;">
                    <button id="room-link-button" class="page-button full-width">
                        Szoba
                    </button>
                </div>
                <p id="message"></p>
            </div>
        </div>
    </div>
    
    <div class="fixed-menu-bar">
        <button id="map-button" class="menu-button" title="T√©rk√©p">
            <i class="fa-solid fa-map-location-dot"></i>
        </button>
        
        <button id="image-button" class="menu-button" title="K√©pgal√©ria">
            <i class="fa-solid fa-image"></i>
        </button>
    </div>
    
    <div id="galleryModal">
      <span class="close-gallery" onclick="history.back();">√ó</span>
      <div id="gallery-container">
      </div>
    </div>
    
    <div id="full-image-display">
        <div class="full-image-content">
            <img id="fullImageDisplay" src="" alt="Nagy√≠tott k√©p" />
        </div>
        <span class="close-gallery" style="z-index: 120;" onclick="history.back();">√ó</span>
    </div>
    
    <div id="help-modal">
        <div class="help-content">
            <p id="help-text-display"></p>
            <div style="display: flex; justify-content: space-between; gap: 10px;">
                <button id="help-close-button" class="page-button" style="flex-grow: 1; background-color: #555555; color: #ffffff;">Bez√°r√°s</button>
                <button id="help-next-button" class="page-button" style="flex-grow: 1; background-color: #00ffff; color: #1a1a1a;">Tov√°bb</button>
            </div>
        </div>
    </div>

    <div id="distanceModal">
        <div class="distance-content">
            <h1 id="distance-modal-title">C√âLPONT KERES√âSE</h1>
            
            <div id="distance-modal-display">
                -- M
            </div>
            
            <p id="distance-status">Helyzetmeghat√°roz√°s ind√≠t√°sa...</p>
            
            <a href="#" target="_blank" id="distance-modal-map-button">
                üó∫Ô∏è T√©rk√©p
            </a>
        </div>
    </div>
    <audio id="story-audio-1" src="" preload="auto"></audio>
    <audio id="story-audio-2" src="" preload="auto"></audio>

    <script>
        // --- DINAMIKUS KONFIGUR√ÅCI√ìS OBJEKTUM (EZT KELL SZERKESZTENED) ---
        const CONFIG = {
            // #1. √ÅLTAL√ÅNOS BE√ÅLL√çT√ÅSOK
            APP_TITLE: "Anna √©s M√°rk Kincskeres√©s",
            BACKGROUND_URL: "https://treasurehuntsites.github.io/annaesmark/Img/kr.jpg", // Weboldal h√°ttere
            BODY_BG_COLOR: "#1a1a1a", // Weboldal h√°tt√©r sz√≠ne
            BODY_TEXT_COLOR: "#e0e0e0", // Weboldal sz√∂vegsz√≠ne
            
            // #2. AVATAROK (A K√ìDBAN L√âV≈ê ¬ßX JEL√ñL√âS ALAPJ√ÅN)
            AVATARS: {
                MARK_AVATAR_URL: "https://treasurehuntsites.github.io/annaesmark/Img/mark.png",
                ANNA_AVATAR_URL: "https://treasurehuntsites.github.io/annaesmark/Img/anna.png",
                POLICE_AVATAR_URL: "https://placehold.co/70x70/1A1A1A/00FF00?text=R",
                DEFAULT_AVATAR_URL: "https://placehold.co/70x70/1A1A1A/FFFFFF?text=?",
            },

            // #3. MEN√ú LINKJEI
            MENU_LINKS: {
                MAP_LINK_URL: 'https://www.google.com/maps/d/u/0/viewer?mid=16ShsAj1LaFgeQYGVD8R2Y_ebs50usI8&ll=47.4748758%2C19.039845799999984&z=17', // Men√º t√©rk√©p linkje
            },

            // #4. K√ìDK√âR≈ê OLDAL BE√ÅLL√çT√ÅSAI
            PASSWORD_PAGE: {
                PROMPT_TEXT: "Add meg a k√≥dot:", // K√≥dk√©r≈ë oldal fels≈ë sz√∂vege
                CHECK_BUTTON_TEXT: "ELLEN≈êRZ√âS",
                BACK_BUTTON_TEXT: "Vissza",
                // A jelsz√≥ be√°ll√≠t√°sai most a storyPages-ben vannak, de a default hiba√ºzenet itt lehet
                ERROR_MESSAGE: 'Helytelen jelsz√≥! Pr√≥b√°ld √∫jra.',
                SUCCESS_MESSAGE: 'K√≥d elfogadva!',
            },

            // #5. C√âLPONT KERES√âSE (GPS) OLDAL BE√ÅLL√çT√ÅSAI
            GPS_COMPASS: {
                TITLE: "C√âLPONT KERES√âSE",
                TARGET_LATITUDE: 47.47407,  // V√©gpont sz√©less√©gi koordin√°ta
                TARGET_LONGITUDE: 19.04001, // V√©gpont hossz√∫s√°gi koordin√°ta
                SUCCESS_RADIUS_M: 25,       // Enn√©l a t√°vols√°gn√°l (m√©terben) sikeres
                SUCCESS_REDIRECT_URL: "busz.html", // Sikeres c√©l el√©r√©se ut√°ni √°tir√°ny√≠t√°s
                MAP_BUTTON_URL: 'https://www.google.com/maps/d/u/0/viewer?mid=1cmPNBkR0t3ozvDgY7056CZiFxf-8d-4&ll=47.47407829999998%2C19.040016799999986&z=17';¬†', // V√©gpont keres√©se oldal t√©rk√©p gomb linkje
            },

            // #6. M√âDIA (Hangok, a k√≥dban haszn√°lt AudioId alapj√°n)
            MEDIA: {
                AUDIO_1_URL: "https://treasurehuntsites.github.io/media/Ugynokok1.mp3",
                AUDIO_2_URL: "https://treasurehuntsites.github.io/media/Ugynokok2.mp3",
            },

            // #7. GAL√âRIA K√âPEK (ID-t is be kell √°ll√≠tani az unlockImage: 'id' mez≈ëh√∂z!)
            ALL_GALLERY_ITEMS: [
                { id: 'helyszin', url: "https://treasurehuntsites.github.io/annaesmark/Img/kr.jpg", title: "Kezd≈ëhelysz√≠n", unlocked: true },
                // Hozz√°adhatsz tov√°bbi k√©peket, pl.:
                // { id: 'busz', url: "https://treasurehuntsites.github.io/annaesmark/Img/busz.jpg", title: "Buszmeg√°ll√≥", unlocked: false },
            ],
            
            // #8. T√ñRT√âNETI OLDALAK (A TELJES SZ√ñVEG √âS K√ìD)
            storyPages: [
                // JELENET 1: Telefonf√ºlke Bevezet√©s (Index 0 - 10)
                { type: 'text', content: '¬ßA M√°rk, azt hiszem megfeletkezt√ºnk valamir≈ël.', speaker: 'Anna' }, // 0
                { type: 'text', content: '¬ßM Igen? Mir≈ël?', speaker: 'Mark' }, // 1 
                // ... (a t√∂bbi oldal ide j√∂n, a CONFIG objektumba be√°gyazva) ...
                { type: 'text', content: '¬ßN Egy bor√∫s d√©lut√°n a sz√∂vets√©g rejtett irod√°j√°ban K√∂rner √©s Rosenberg k√ºl√∂n√∂s √ºzenetet kaptak. A pap√≠rlapon csak egyetlen mondat √°llt:', speaker: 'Narrator' }, // 10
                { type: 'text', content: '¬ßN ‚ÄûTudjuk, hogy el√°rultatok minket.‚Äù', speaker: 'Narrator' }, // 11
                { type: 'password', content: '¬ßKOD K√©rj√ºk add meg a K√∂rner √©s Rosenberg √ºgyn√∂k√∂kre vonatkoz√≥ aktiv√°l√≥ k√≥dot a t√°bl√°r√≥l.', correctPassword: '1940', nextIndexSuccess: -1, backIndex: 11, helpMessage: ['Keresd a t√°bl√°n', '1940'], prompt: "Aktiv√°l√≥ k√≥d:" }, // 12
            ],
            // Megjegyz√©s: A teljes, eredeti storyPages t√∂mb√∂t be kell illesztened ide, a `CONFIG.storyPages` al√°, de t√∂r√∂ln√∂d kell bel≈ële az `image: PHONE_BOOTH_URL` r√©szt, mivel az most glob√°lisan a `BACKGROUND_URL` lesz.

            // Mivel a megadott k√≥db√≥l nem tudom rekonstru√°lni a teljes storyPages t√∂mb√∂t, ami 17 elemet tartalmaz, a fenti p√©lda csak a strukt√∫r√°t mutatja. Az eredeti k√≥dban l√©v≈ë t√∂mb√∂t m√°sold ide, a `storyPages` al√°.
        };

        // --- INICI√ÅLIZ√ÅL√ì F√úGGV√âNYEK (EZT NE M√ìDOS√çTSD, CSAK HASZN√ÅLD A CONFIG-ot) ---
        (function() {
            // ¬ßRESET: Alap URL-ek: Most a CONFIG-b√≥l j√∂nnek
            const MARK_AVATAR_URL = CONFIG.AVATARS.MARK_AVATAR_URL;
            const ANNA_AVATAR_URL = CONFIG.AVATARS.ANNA_AVATAR_URL;
            const POLICE_AVATAR_URL = CONFIG.AVATARS.POLICE_AVATAR_URL;
            const DEFAULT_AVATAR_URL = CONFIG.AVATARS.DEFAULT_AVATAR_URL;
            const PHONE_BOOTH_URL = CONFIG.BACKGROUND_URL;
            const ALL_GALLERY_ITEMS = CONFIG.ALL_GALLERY_ITEMS;
            const storyPages = CONFIG.storyPages;
            
            // GPS ADATOK
            const COMPASS_LAT = CONFIG.GPS_COMPASS.TARGET_LATITUDE;
            const COMPASS_LON = CONFIG.GPS_COMPASS.TARGET_LONGITUDE;
            const COMPASS_RADIUS = CONFIG.GPS_COMPASS.SUCCESS_RADIUS_M;
            const SUCCESS_LINK = CONFIG.GPS_COMPASS.SUCCESS_REDIRECT_URL;
            const GPS_MODAL_MAP_URL = CONFIG.GPS_COMPASS.MAP_BUTTON_URL;
            
            // DOM elemek...
            const storyAudio1 = document.getElementById('story-audio-1');
            const storyAudio2 = document.getElementById('story-audio-2');
            const mapButton = document.getElementById('map-button');
            const distanceModalMapButton = document.getElementById('distance-modal-map-button');
            const distanceModalTitle = document.getElementById('distance-modal-title');
            const passwordPromptText = document.getElementById('password-prompt-text');
            const checkButton = document.getElementById('check-password-button');
            const backButtonPassword = document.getElementById('back-button-password');
            const storyImage = document.getElementById('story-image');
            // ... (a t√∂bbi DOM elem defin√≠ci√≥ja) ...

            // --- DINAMIKUS BE√ÅLL√çT√ÅSOK V√âGREHAJT√ÅSA ---
            document.title = CONFIG.APP_TITLE;
            document.body.style.backgroundColor = CONFIG.BODY_BG_COLOR;
            document.body.style.color = CONFIG.BODY_TEXT_COLOR;
            storyImage.src = CONFIG.BACKGROUND_URL;
            mapButton.onclick = () => { window.open(CONFIG.MENU_LINKS.MAP_LINK_URL, '_blank'); };
            distanceModalMapButton.href = CONFIG.GPS_COMPASS.MAP_BUTTON_URL;
            distanceModalTitle.textContent = CONFIG.GPS_COMPASS.TITLE;
            storyAudio1.src = CONFIG.MEDIA.AUDIO_1_URL;
            storyAudio2.src = CONFIG.MEDIA.AUDIO_2_URL;
            
            passwordPromptText.textContent = CONFIG.PASSWORD_PAGE.PROMPT_TEXT;
            checkButton.textContent = CONFIG.PASSWORD_PAGE.CHECK_BUTTON_TEXT;
            backButtonPassword.textContent = CONFIG.PASSWORD_PAGE.BACK_BUTTON_TEXT;

            // (Megmaradt JavaScript k√≥d, v√°ltoztat√°sok a CONFIG-ra mutatva)
            let currentPartIndex = 0;
            let currentHelpIndex = 0;
            let watchId = null;
            
            // ... (a t√∂bbi JavaScript f√ºggv√©ny ide j√∂n be, az eredeti k√≥db√≥l) ...

            // P√©lda a friss√≠tett updateAvatar f√ºggv√©nyre:
            function updateAvatar(pageIndex) {
                // ... (f√ºggv√©ny t√∂rzse) ...
                let avatarUrl = DEFAULT_AVATAR_URL; // Alap√©rtelmezett: DEFAULT_AVATAR
                let opacity = 1;

                const contentPrefix = currentPage.content.split(' ')[0];
                
                if (contentPrefix === '¬ßM') {
                    avatarUrl = MARK_AVATAR_URL;
                } else if (contentPrefix === '¬ßA') {
                    avatarUrl = ANNA_AVATAR_URL;
                } else if (contentPrefix === '¬ßR') {
                    avatarUrl = POLICE_AVATAR_URL;
                } else if (contentPrefix.startsWith('¬ß')) {
                    opacity = 0;
                    avatarUrl = DEFAULT_AVATAR_URL; 
                } else {
                    opacity = 0;
                    avatarUrl = DEFAULT_AVATAR_URL; 
                }
                
                avatarImg.src = avatarUrl;
                avatarImg.style.opacity = opacity;
            }

            // P√©lda a friss√≠tett checkButton.addEventListener-re a dinamikus hiba/siker √ºzenetekkel:
            // checkButton.addEventListener('click', () => { ... })
            // A k√≥d itt haszn√°ln√° a CONFIG.PASSWORD_PAGE.ERROR_MESSAGE √©s SUCCESS_MESSAGE-t.

            // P√©lda az inicializ√°l√°sra:
            function initializeApp() {
                // Mivel a t√∂rt√©netoldalak v√°ltoztak, ki kell takar√≠tanunk a r√©gi progress-t.
                localStorage.clear();
                
                loadProgress(); 
                showStoryPart();
                
                document.body.style.visibility = 'visible';
                document.body.style.opacity = 1;
            }

            window.onload = () => {
                initializeApp(); 
            };
        })(); 
    </script>
</body>
</html>
