<!doctype html>
<html lang="hu">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0">
    <title>Játék Konfiguráció</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1a1a1a; color: #e0e0e0; }
        .card { background-color: #2c2c2c; border: 2px solid #8a2be2; box-shadow: 0 0 20px rgba(138, 43, 226, 0.4); }
        .input-style { background-color: #3f3f46; color: #00ffff; border: 1px solid #6b7280; }
        .btn-primary { background-color: #8a2be2; color: white; transition: background-color 0.2s; }
        .btn-primary:hover { background-color: #7b1cd1; }
        .btn-secondary { background-color: #00ffff; color: #1a1a1a; font-weight: bold; transition: background-color 0.2s; }
        .btn-secondary:hover { background-color: #00ddee; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">
    <div class="max-w-4xl mx-auto space-y-8">
        <h1 class="text-4xl font-bold text-center text-white mb-6">Játék Konfigurációs Vezérlőpult</h1>

        <div class="card p-6 rounded-xl space-y-6">
            <h2 class="text-2xl font-semibold text-white border-b border-gray-600 pb-2">Általános Beállítások</h2>
            
            <div>
                <label for="appTitle" class="block text-sm font-medium text-gray-300 mb-1">Weboldal Címe (Title)</label>
                <input type="text" id="appTitle" class="input-style w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="Pl.: Anna és Márk Kincskeresés">
            </div>

            <div>
                <label for="backgroundUrl" class="block text-sm font-medium text-gray-300 mb-1">Háttérkép URL-je</label>
                <input type="url" id="backgroundUrl" class="input-style w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="https://...">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="bgColor" class="block text-sm font-medium text-gray-300 mb-1">Háttér Színe (CSS)</label>
                    <input type="color" id="bgColor" class="input-style w-full h-12 rounded-lg" value="#1a1a1a">
                </div>
                <div>
                    <label for="textColor" class="block text-sm font-medium text-gray-300 mb-1">Szöveg Színe (CSS)</label>
                    <input type="color" id="textColor" class="input-style w-full h-12 rounded-lg" value="#e0e0e0">
                </div>
            </div>
            
        </div>

        <div class="card p-6 rounded-xl space-y-6">
            <h2 class="text-2xl font-semibold text-white border-b border-gray-600 pb-2">Menü és GPS Beállítások</h2>

            <div>
                <label for="menuMapLink" class="block text-sm font-medium text-gray-300 mb-1">Menü Térkép Linkje (Fő Térkép)</label>
                <input type="url" id="menuMapLink" class="input-style w-full p-3 rounded-lg focus:ring-cyan-500 focus:border-cyan-500" placeholder="https://maps.google.com/...">
            </div>

            <h3 class="text-xl font-medium text-gray-200 mt-6">Célpont Keresése (GPS)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="targetLat" class="block text-sm font-medium text-gray-300 mb-1">Célpont Szélesség (Lat)</label>
                    <input type="text" id="targetLat" class="input-style w-full p-3 rounded-lg" placeholder="47.47407">
                </div>
                <div>
                    <label for="targetLon" class="block text-sm font-medium text-gray-300 mb-1">Célpont Hosszúság (Lon)</label>
                    <input type="text" id="targetLon" class="input-style w-full p-3 rounded-lg" placeholder="19.04001">
                </div>
                <div>
                    <label for="successRedirectUrl" class="block text-sm font-medium text-gray-300 mb-1">Siker Átirányítás URL</label>
                    <input type="text" id="successRedirectUrl" class="input-style w-full p-3 rounded-lg" placeholder="busz.html">
                </div>
            </div>
            
            <div>
                <label for="gpsMapLink" class="block text-sm font-medium text-gray-300 mb-1">Végpont Keresése Térkép Link (GPS Modal)</label>
                <input type="url" id="gpsMapLink" class="input-style w-full p-3 rounded-lg focus:ring-cyan-500 focus:border-cyan-500" placeholder="https://maps.google.com/...">
            </div>
        </div>

        <div class="card p-6 rounded-xl space-y-6">
            <h2 class="text-2xl font-semibold text-white border-b border-gray-600 pb-2">Kódkérő Oldal Beállításai (Index 16)</h2>
            
            <div>
                <label for="passwordPromptText" class="block text-sm font-medium text-gray-300 mb-1">Kódkérő Prompt Szöveg</label>
                <input type="text" id="passwordPromptText" class="input-style w-full p-3 rounded-lg" placeholder="Add meg a kódot:">
            </div>

            <div>
                <label for="passwordContent" class="block text-sm font-medium text-gray-300 mb-1">Oldal Szövege (pl. §KOD Kérjük add meg...)</label>
                <textarea id="passwordContent" rows="3" class="input-style w-full p-3 rounded-lg"></textarea>
            </div>

            <div>
                <label for="correctPassword" class="block text-sm font-medium text-gray-300 mb-1">Helyes Kód / Jelszó</label>
                <input type="text" id="correctPassword" class="input-style w-full p-3 rounded-lg" placeholder="1940">
            </div>
        </div>
        
        <div class="flex flex-col sm:flex-row justify-between gap-4 pt-4">
            <button id="saveButton" class="btn-primary w-full sm:w-1/2 p-4 rounded-xl text-lg font-bold uppercase">
                <i class="fa-solid fa-floppy-disk mr-2"></i> Beállítások Mentése
            </button>
            <a id="goToGameButton" href="game.html" target="_blank" class="btn-secondary w-full sm:w-1/2 p-4 rounded-xl text-lg font-bold uppercase text-center">
                <i class="fa-solid fa-play mr-2"></i> Játék Megnyitása
            </a>
        </div>

        <p id="message" class="text-center mt-4 text-xl font-bold"></p>
    </div>

    <script>
        // Az adminisztrációs logika
        (function() {
            const STORAGE_KEY = 'DYNAMIC_CONFIG';
            const MESSAGE_DISPLAY = document.getElementById('message');

            // DOM elemek összegyűjtése
            const fields = {
                appTitle: document.getElementById('appTitle'),
                backgroundUrl: document.getElementById('backgroundUrl'),
                bgColor: document.getElementById('bgColor'),
                textColor: document.getElementById('textColor'),
                menuMapLink: document.getElementById('menuMapLink'),
                targetLat: document.getElementById('targetLat'),
                targetLon: document.getElementById('targetLon'),
                successRedirectUrl: document.getElementById('successRedirectUrl'),
                gpsMapLink: document.getElementById('gpsMapLink'),
                passwordPromptText: document.getElementById('passwordPromptText'),
                passwordContent: document.getElementById('passwordContent'),
                correctPassword: document.getElementById('correctPassword')
            };

            // Alapértelmezett konfiguráció (ahhoz, hogy tudjuk, honnan induljunk)
            const DEFAULT_CONFIG = {
                APP_TITLE: "Anna és Márk Kincskeresés (Alapértelmezett)",
                BACKGROUND_URL: "https://treasurehuntsites.github.io/annaesmark/Img/kr.jpg",
                BODY_BG_COLOR: "#1a1a1a",
                BODY_TEXT_COLOR: "#e0e0e0",
                MENU_LINKS: { MAP_LINK_URL: 'https://www.google.com/maps/d/u/0/viewer?mid=16ShsAj1LaFgeQYGVD8R2Y_ebs50usI8&ll=47.4748758%2C19.039845799999984&z=17' },
                GPS_COMPASS: {
                    TARGET_LATITUDE: 47.47407,
                    TARGET_LONGITUDE: 19.04001,
                    SUCCESS_REDIRECT_URL: "busz.html",
                    MAP_BUTTON_URL: 'https://www.google.com/maps/d/u/0/viewer?mid=1cmPNBkR0t3ozvDgY7056CZiFxf-8d-4&ll=47.47407829999998%2C19.040016799999986&z=17',
                },
                PASSWORD_PAGE: { PROMPT_TEXT: "Add meg a kódot:" },
                storyPages: getDefaultStoryPages(), // Vágjunk ki egy segédfüggvényt a storyPages-nek
                // Avatarok és egyéb beállítások itt lennének, de a mentésnél csak a fő értékeket frissítjük
            };

            // Segédfüggvény a teljes storyPages tömb visszaadásához
            function getDefaultStoryPages() {
                // Ezt a tömböt az előző válaszomból másoltam át, ez a játék teljes szkriptje
                return [
                    { type: 'text', content: '§A Márk, azt hiszem megfeletkeztünk valamiről.' }, 
                    { type: 'text', content: '§M Igen? Miről?' }, 
                    { type: 'text', content: '§A Itt van tessék.' }, 
                    { type: 'text', content: '§N Az épület falán egy emléktábla áll, amiről könnyen leolvasható egy négy jegyű kód.' }, 
                    { type: 'text', content: '§A Ez túl nyilvános. Mi van, ha figyelnek minket?' }, 
                    { type: 'text', content: '§M Nyugodj meg, a bűnszervezet valószínűleg még nem tudja, hogy itt vagyunk.' }, 
                    { type: 'text', content: '§A Ki ez a két alak a táblán?' }, 
                    { type: 'text', content: '§N Körner és Rosenberg hírhedten rejtélyes ügynökök voltak, akik a szövetség legsötétebb és legkiszámíthatatlanabb műveleteiben vettek részt.' }, 
                    { type: 'text', content: '§N Az ő stílusuk a kiszámított káosz volt: nyomokat hagytak, amelyeket még a saját szövetségük ügynökei is alig értettek meg.' }, 
                    { type: 'text', content: '§N Egyik küldetésük azonban messze túlmutatott a megszokott játékukon, és olyan következményekkel járt, amire még ők sem számítottak.' }, 
                    { type: 'text', content: '§N Egy borús délután a szövetség rejtett irodájában Körner és Rosenberg különös üzenetet kaptak. A papírlapon csak egyetlen mondat állt:' }, 
                    { type: 'text', content: '§N „Tudjuk, hogy elárultatok minket.”' }, 
                    { type: 'text', content: '§N Rosenberg: „Ez valami rossz vicc?”' }, 
                    { type: 'text', content: '§N Körner: „Nem, ez valami más. Egy teszt. Valaki próbára akar tenni minket.”' }, 
                    { type: 'text', content: '§N A levélhez egy helyszín is tartozott: egy elhagyatott park a közelben a Feneketlen-tó szomszédságában.' }, 
                    { 
                        type: 'text', 
                        content: '§N Annak ellenére, hogy a szövetség nem adott hivatalos megbízást, a két ügynök úgy döntött, utánajár a rejtélynek, és a mai napon Anna és Márk is így tett.'
                    }, 
                    { 
                        type: 'password', 
                        content: '§KOD Kérjük add meg a táblán látható kódot.', 
                        correctPassword: '1940', 
                        nextIndexSuccess: -1, 
                        backIndex: 15, 
                        helpMessage: ['Keresd a táblán', '1940'] 
                    }, 
                ];
            }

            // 1. Adatok betöltése a DOM-ba
            function loadSettings() {
                const savedData = localStorage.getItem(STORAGE_KEY);
                let currentConfig = savedData ? JSON.parse(savedData) : DEFAULT_CONFIG;

                // Az alap adatok feltöltése (a CONFIG struktúrájához igazítva)
                fields.appTitle.value = currentConfig.APP_TITLE || DEFAULT_CONFIG.APP_TITLE;
                fields.backgroundUrl.value = currentConfig.BACKGROUND_URL || DEFAULT_CONFIG.BACKGROUND_URL;
                fields.bgColor.value = currentConfig.BODY_BG_COLOR || DEFAULT_CONFIG.BODY_BG_COLOR;
                fields.textColor.value = currentConfig.BODY_TEXT_COLOR || DEFAULT_CONFIG.BODY_TEXT_COLOR;
                
                fields.menuMapLink.value = currentConfig.MENU_LINKS.MAP_LINK_URL || DEFAULT_CONFIG.MENU_LINKS.MAP_LINK_URL;

                fields.targetLat.value = currentConfig.GPS_COMPASS.TARGET_LATITUDE || DEFAULT_CONFIG.GPS_COMPASS.TARGET_LATITUDE;
                fields.targetLon.value = currentConfig.GPS_COMPASS.TARGET_LONGITUDE || DEFAULT_CONFIG.GPS_COMPASS.TARGET_LONGITUDE;
                fields.successRedirectUrl.value = currentConfig.GPS_COMPASS.SUCCESS_REDIRECT_URL || DEFAULT_CONFIG.GPS_COMPASS.SUCCESS_REDIRECT_URL;
                fields.gpsMapLink.value = currentConfig.GPS_COMPASS.MAP_BUTTON_URL || DEFAULT_CONFIG.GPS_COMPASS.MAP_BUTTON_URL;
                
                // Kódkérő oldal specifikus adatai (Index 16 - feltételezzük, hogy ez a kódkérő oldal)
                const passwordPage = currentConfig.storyPages.find(p => p.type === 'password' && p.content.startsWith('§KOD')) || DEFAULT_CONFIG.storyPages[16];

                fields.passwordPromptText.value = currentConfig.PASSWORD_PAGE.PROMPT_TEXT || DEFAULT_CONFIG.PASSWORD_PAGE.PROMPT_TEXT;
                fields.passwordContent.value = passwordPage.content;
                fields.correctPassword.value = passwordPage.correctPassword;
            }

            // 2. Adatok kimentése a localStorage-ba
            function saveSettings() {
                // Először betöltjük a teljes aktuális CONFIG-ot (beleértve a nem szerkesztett adatokat is)
                const savedData = localStorage.getItem(STORAGE_KEY);
                let newConfig = savedData ? JSON.parse(savedData) : DEFAULT_CONFIG;

                // A storyPages a legbonyolultabb, ezért másoljuk az alapértelmezettet, ha még nem létezik
                if (!newConfig.storyPages || newConfig.storyPages.length === 0) {
                    newConfig.storyPages = getDefaultStoryPages();
                }

                // Felülírjuk az egyszerű értékeket
                newConfig.APP_TITLE = fields.appTitle.value;
                newConfig.BACKGROUND_URL = fields.backgroundUrl.value;
                newConfig.BODY_BG_COLOR = fields.bgColor.value;
                newConfig.BODY_TEXT_COLOR = fields.textColor.value;
                
                newConfig.MENU_LINKS.MAP_LINK_URL = fields.menuMapLink.value;

                newConfig.GPS_COMPASS.TARGET_LATITUDE = parseFloat(fields.targetLat.value) || newConfig.GPS_COMPASS.TARGET_LATITUDE;
                newConfig.GPS_COMPASS.TARGET_LONGITUDE = parseFloat(fields.targetLon.value) || newConfig.GPS_COMPASS.TARGET_LONGITUDE;
                newConfig.GPS_COMPASS.SUCCESS_REDIRECT_URL = fields.successRedirectUrl.value;
                newConfig.GPS_COMPASS.MAP_BUTTON_URL = fields.gpsMapLink.value;
                
                newConfig.PASSWORD_PAGE.PROMPT_TEXT = fields.passwordPromptText.value;

                // Kódkérő oldal frissítése (Index 16 feltételezésével)
                const passwordPageIndex = newConfig.storyPages.findIndex(p => p.type === 'password' && p.content.startsWith('§KOD'));
                const targetIndex = passwordPageIndex !== -1 ? passwordPageIndex : 16; 
                
                if (newConfig.storyPages[targetIndex]) {
                    newConfig.storyPages[targetIndex].content = fields.passwordContent.value;
                    newConfig.storyPages[targetIndex].correctPassword = fields.correctPassword.value;
                    // Frissítjük a súgót is
                    if (newConfig.storyPages[targetIndex].helpMessage && newConfig.storyPages[targetIndex].helpMessage.length > 1) {
                        newConfig.storyPages[targetIndex].helpMessage[1] = fields.correctPassword.value;
                    }
                } else {
                    console.error("Hiba: A kódkérő oldal nem található a storyPages-ben.");
                }

                // Mentés
                localStorage.setItem(STORAGE_KEY, JSON.stringify(newConfig));

                MESSAGE_DISPLAY.textContent = 'Beállítások sikeresen elmentve! Frissítsd a Játék oldalt!';
                MESSAGE_DISPLAY.style.color = '#00FF00';
                setTimeout(() => MESSAGE_DISPLAY.textContent = '', 4000);
            }

            // Indítás
            document.addEventListener('DOMContentLoaded', loadSettings);
            document.getElementById('saveButton').addEventListener('click', saveSettings);
        })();
    </script>
</body>
</html>
