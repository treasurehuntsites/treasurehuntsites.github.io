<script>
    // Glob√°lis v√°ltoz√≥ a szkenner objektumhoz
    let html5QrCode = null;

    function onScanSuccess(decodedText) {
        // ... (sikeres beolvas√°s logika - CNN-re ugr√°s)
        document.getElementById('result').innerHTML = `<p class="success">Sikeres beolvas√°s! Tartalom: <b>${decodedText}</b></p>`;
        
        // Kamer√°t le√°ll√≠tjuk
        html5QrCode.stop().then(() => {
            document.getElementById('reader').style.display = 'none';
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('startButton').disabled = false;
        }).catch(error => {
            console.error("Hiba a szkenner le√°ll√≠t√°sakor: ", error);
        });

        if (decodedText.trim() === "ABC") {
            document.getElementById('result').innerHTML += '<p>‚úÖ K√≥d elfogadva! Tov√°bbir√°ny√≠t√°s a cnn.com oldalra...</p>';
            setTimeout(() => {
                window.location.href = 'https://www.cnn.com';
            }, 1500); 
        } else {
            document.getElementById('result').innerHTML += '<p class="error">‚ùå √ârv√©nytelen k√≥d. (Elv√°rt: ABC)</p>';
        }
    }

    document.getElementById('startButton').addEventListener('click', () => {
        document.getElementById('startButton').disabled = true; 
        document.getElementById('result').innerHTML = '<p>üì∑ K√©nyszer√≠tett kamera ind√≠t√°s...</p>';

        if (!html5QrCode) {
            html5QrCode = new Html5Qrcode("reader");
        }

        document.getElementById('startButton').style.display = 'none';
        document.getElementById('reader').style.display = 'block';

        html5QrCode.start(
            { facingMode: "environment" }, // H√°ts√≥ kamera k√©nyszer√≠t√©se
            { fps: 10, qrbox: 250 },
            onScanSuccess, 
            (errorMessage) => {}
        ).catch((err) => {
            // FONTOS: Ez a r√©sz most megmondja, mi√©rt blokkolta a k√∂nyvt√°r
            document.getElementById('result').innerHTML = `<p class="error">‚ùå Hiba! Kamera ind√≠t√°s sikertelen. Hiba√ºzenet: <b>${err}</b></p>`;
            
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('startButton').disabled = false;
            document.getElementById('reader').style.display = 'none';
        });
    });
</script>
